'use strict';
const levenshtein = require('fastest-levenshtein');

const dataSearch = function(data, query) {
  const searchSpace = [];
  const iter = data.all ? data.all() : data;
  for(const item of iter) {
    if(!['CAP', 'Custom'].includes(item.isNonstandard)) {
      searchSpace.push(item.id);
    }
  }

  const result = levenshtein.closest(query, searchSpace);
  const distance = levenshtein.distance(query, result);
  const range = query.length < 4 ? 1 : query.length < 6 ? 2 : 3;

  if(distance > range) {
    return null;
  }
  return {result: data.get(result), distance: distance};
};

module.exports = dataSearch;

